<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Escrow.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Escrow.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/57</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/62</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/16</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/100</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//SPDX-License-Identifier: MIT
pragma solidity ^0.8.14;
&nbsp;
import "./interfaces/IERC4907.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
&nbsp;
contract Escrow is Ownable {
    enum Status {
        RENTED,
        AVAILABLE
    }
&nbsp;
    struct Listing {
        uint256 hourlyPrice;
        uint256 maxDays;
        address owner;
        uint256 advanceTime; // in seconds
        Status status;
    }
&nbsp;
    address private immutable s_nftAddress;
    uint256 private immutable s_fee;
&nbsp;
    mapping(uint256 =&gt; Listing) private s_listings;
    mapping(address =&gt; uint256) private s_balances;
    mapping(address =&gt; mapping(address =&gt; uint256)) s_rentals;
    mapping(address =&gt; bool) public s_ownerStatus;
    mapping(address =&gt; bool) public s_borrowerStatus;
    mapping(uint256 =&gt; mapping(address =&gt; uint256)) s_fines;
&nbsp;
    event ItemListed(
        address indexed seller,
        address indexed nftAddress,
        uint256 indexed tokenId,
        uint256 price,
        uint256 advanceTime
    );
&nbsp;
    event rentedItem(
        uint256 indexed _tokenId,
        address rentedUser,
        uint256 expiryTime
    );
&nbsp;
    event updatedListing(
        uint256 tokenId,
        uint256 price,
        uint256 maxDays,
        uint256 advanceTime,
        address owner
    );
&nbsp;
    event carDelisted(uint256 indexed _tokenId, address indexed owner);
    event finePaid(uint256 indexed _tokenId, address indexed borrower, uint256 fine);
&nbsp;
    error NFT_ALERADY_LISTED();
    error NOT_THE_OWNER();
    error NOT_APPROVED_BY_OWNER();
    error PriceMustBeAboveZero();
    error CAR_NOT_LISTED();
    error CANNOT_RENT_FOR_THAT_MUCH_DAYS();
    error ALERADY_RENTED_TO_SOMEONE();
    error LISTING_IS_IN_RENTED_STATE();
    error ZERO_PROCEEDS(); 
    error CAR_NOT_RENTED_TO_CALLER();
    error ALERADY_TURNED_IN();
    error NOT_THE_BORROWER();
    error NOT_RENTED_YET();
    error NOT_TURNED_IN();
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier notListed(uint256 tokenId) {</span>
<span class="cstat-no" title="statement not covered" >        Listing memory listing = s_listings[tokenId];</span>
<span class="cstat-no" title="statement not covered" >        if (listing.hourlyPrice &gt; 0) {</span>
            revert NFT_ALERADY_LISTED();
        }
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier isOwner(uint256 tokenId, address spender) {</span>
<span class="cstat-no" title="statement not covered" >        IERC4907 _nft = IERC4907(s_nftAddress);</span>
<span class="cstat-no" title="statement not covered" >        address owner = _nft.ownerOf(tokenId);</span>
<span class="cstat-no" title="statement not covered" >        if (owner != spender) {</span>
            revert NOT_THE_OWNER();
        }
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier isListed(uint256 _tokenId) {</span>
<span class="cstat-no" title="statement not covered" >        Listing memory listing = s_listings[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >        if (listing.hourlyPrice == 0) {</span>
            revert CAR_NOT_LISTED();
        }
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier inTimeLimits(uint256 _tokenId, uint256 _expiry) {</span>
        /*TO check whether the expiry time by user in unix is less than or equal to block.timestamp + advancedTime */
<span class="cstat-no" title="statement not covered" >        Listing memory listing = s_listings[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >        uint256 extraTime = block.timestamp + listing.advanceTime;</span>
<span class="cstat-no" title="statement not covered" >        if (extraTime &gt; _expiry) {</span>
            revert CANNOT_RENT_FOR_THAT_MUCH_DAYS();
        }
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    constructor(address _nftAddress, uint256 _fee) {</span>
        s_nftAddress = _nftAddress;
        s_fee = _fee;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function listCar(</span>
        uint256 _tokenId,
        uint256 _price,
        uint256 _maxDays,
        uint256 _advanceTime
    ) public notListed(_tokenId) isOwner(_tokenId, msg.sender) {
<span class="cstat-no" title="statement not covered" >        if (_price &lt;= 0) {</span>
            revert PriceMustBeAboveZero();
        }
<span class="cstat-no" title="statement not covered" >        IERC4907 _nft = IERC4907(s_nftAddress);</span>
<span class="cstat-no" title="statement not covered" >        if (_nft.getApproved(_tokenId) != address(this)) {</span>
            revert NOT_APPROVED_BY_OWNER();
        }
<span class="cstat-no" title="statement not covered" >        Listing memory listing = Listing({</span>
            hourlyPrice: _price,
            maxDays: _maxDays,
            owner: msg.sender,
            advanceTime: _advanceTime,
            status: Status.AVAILABLE
        });
        s_listings[_tokenId] = listing;
<span class="cstat-no" title="statement not covered" >        emit ItemListed(</span>
            msg.sender,
            s_nftAddress,
            _tokenId,
            _price,
            _advanceTime
        );
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function rentCar(</span>
        uint256 _tokenId,
        uint256 _expiryTime
    ) public payable isListed(_tokenId) inTimeLimits(_tokenId, _expiryTime) {
        /*we have to rent the nft to user */
        // first check the car is alerady rented or not
<span class="cstat-no" title="statement not covered" >        IERC4907 _nft = IERC4907(s_nftAddress);</span>
<span class="cstat-no" title="statement not covered" >        address rentalUser = _nft.userOf(_tokenId);</span>
<span class="cstat-no" title="statement not covered" >        Listing storage listing = s_listings[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >        Status _status = listing.status;</span>
<span class="cstat-no" title="statement not covered" >        if (rentalUser != address(0) || _status == Status.RENTED) {</span>
            revert ALERADY_RENTED_TO_SOMEONE();
        }
        // First fetch the lisiting
<span class="cstat-no" title="statement not covered" >        _nft.setUser(_tokenId, msg.sender, _expiryTime)</span>;
        s_rentals[listing.owner][msg.sender] = block.timestamp;
        listing.status = Status.RENTED;
        s_ownerStatus[listing.owner] = false;
        s_borrowerStatus[msg.sender] = false;
<span class="cstat-no" title="statement not covered" >        emit rentedItem(_tokenId, msg.sender, _expiryTime);</span>
        // update the balances for the nft owner
        s_balances[listing.owner] += msg.value;
    }
&nbsp;
    //function to cancelListings
<span class="fstat-no" title="function not covered" >    function cancelListing(</span>
        uint256 _tokenId
    ) public isOwner(_tokenId, msg.sender) {
<span class="cstat-no" title="statement not covered" >        Listing memory listing = s_listings[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >        if (listing.status == Status.RENTED) {</span>
            revert LISTING_IS_IN_RENTED_STATE();
        }
        delete s_listings[_tokenId];
<span class="cstat-no" title="statement not covered" >        emit carDelisted(_tokenId, msg.sender);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function updateListing(</span>
        uint256 _tokenId,
        uint256 _price,
        uint256 _maxDays,
        uint256 _advanceTime
    ) public isListed(_tokenId) isOwner(_tokenId, msg.sender) {
<span class="cstat-no" title="statement not covered" >         if (_price &lt;= 0) {</span>
            revert PriceMustBeAboveZero();
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        Listing storage listing = s_listings[_tokenId];</span>
        
<span class="cstat-no" title="statement not covered" >         if (listing.status == Status.RENTED) {</span>
            revert LISTING_IS_IN_RENTED_STATE();
        }
        listing.hourlyPrice = _price;
        listing.maxDays = _maxDays;
        listing.advanceTime = _advanceTime;
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit updatedListing(_tokenId, _price, _maxDays, _advanceTime, msg.sender);</span>
    }
    //function to withdrawAmount+
&nbsp;
<span class="fstat-no" title="function not covered" >    function withdraw() public {</span>
<span class="cstat-no" title="statement not covered" >      if(s_balances[msg.sender] == 0){</span>
        revert ZERO_PROCEEDS();
      }
<span class="cstat-no" title="statement not covered" >      uint256 amount = s_balances[msg.sender];</span>
      s_balances[msg.sender] = 0;
<span class="cstat-no" title="statement not covered" >      (bool success,) = payable(msg.sender).call{value : amount}("");</span>
<span class="cstat-no" title="statement not covered" >      require(success, "Else transaction failed")</span>;
    }
    // fine function
&nbsp;
<span class="fstat-no" title="function not covered" >    function turnInByOwner(uint256 _tokenId) public isOwner(_tokenId,msg.sender) {</span>
<span class="cstat-no" title="statement not covered" >     IERC4907 _nft = IERC4907(s_nftAddress);</span>
      
<span class="cstat-no" title="statement not covered" >      if(s_ownerStatus[msg.sender] == true){</span>
        revert ALERADY_TURNED_IN();
       }
<span class="cstat-no" title="statement not covered" >      address borrower = _nft.userOf(_tokenId);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >     if(borrower != address(0) &amp;&amp; s_borrowerStatus[borrower] == true){</span>
<span class="cstat-no" title="statement not covered" >        uint256 amount = ((block.timestamp - s_rentals[msg.sender][borrower]) * s_fee)/3600;</span>
        s_fines[_tokenId][borrower] = amount;
     }
     s_ownerStatus[msg.sender] = true;
    }
     
<span class="fstat-no" title="function not covered" >     function turnInByBorrower(uint256 _tokenId) public {</span>
<span class="cstat-no" title="statement not covered" >         IERC4907 _nft = IERC4907(s_nftAddress);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >         if(_nft.userOf(_tokenId)  != msg.sender){</span>
          revert NOT_THE_BORROWER();
         }
&nbsp;
<span class="cstat-no" title="statement not covered" >         if(s_borrowerStatus[msg.sender] == true){</span>
            revert ALERADY_TURNED_IN();
         }
&nbsp;
<span class="cstat-no" title="statement not covered" >         address owner = _nft.ownerOf(_tokenId);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >         if(s_ownerStatus[owner] == true){</span>
<span class="cstat-no" title="statement not covered" >            uint256 amount = ((block.timestamp - s_rentals[owner][msg.sender]) * s_fee)/3600;</span>
            s_fines[_tokenId][msg.sender] = amount;
         }
         s_borrowerStatus[msg.sender] = true;
&nbsp;
     }    
&nbsp;
<span class="fstat-no" title="function not covered" >     function payFee(uint256 _tokenId) public payable{</span>
<span class="cstat-no" title="statement not covered" >       Listing storage listing = s_listings[_tokenId];</span>
<span class="cstat-no" title="statement not covered" >       IERC4907 _nft = IERC4907(s_nftAddress);</span>
<span class="cstat-no" title="statement not covered" >       address borrower = _nft.userOf(_tokenId);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >       if(borrower != msg.sender){</span>
        revert NOT_THE_BORROWER();
       }
       delete  s_fines[_tokenId][borrower];
       s_balances[_nft.ownerOf(_tokenId)] += msg.value;
       listing.status = Status.AVAILABLE;
       delete s_borrowerStatus [borrower];
       delete s_ownerStatus[_nft.ownerOf(_tokenId)];
<span class="cstat-no" title="statement not covered" >       emit finePaid(_tokenId, msg.sender,msg.value);</span>
     }
&nbsp;
<span class="fstat-no" title="function not covered" >    function viewBalance() public view returns(uint256){</span>
<span class="cstat-no" title="statement not covered" >        return s_balances[msg.sender];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getFine(uint256 _tokenId) public view returns(uint256){</span>
<span class="cstat-no" title="statement not covered" >        IERC4907 _nft = IERC4907(s_nftAddress);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(!s_ownerStatus[_nft.ownerOf(_tokenId)] || !s_borrowerStatus[_nft.userOf(_tokenId)]){</span>
            revert NOT_TURNED_IN();
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(_nft.userOf(_tokenId) == address(0)){</span>
            revert NOT_RENTED_YET();
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(s_ownerStatus[_nft.ownerOf(_tokenId)] &amp;&amp; s_borrowerStatus[_nft.userOf(_tokenId)]){</span>
<span class="cstat-no" title="statement not covered" >             return s_fines[_tokenId][_nft.userOf(_tokenId)] ;</span>
    }
<span class="cstat-no" title="statement not covered" >        return 0;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getListing(uint256 _tokenId) public view returns(Listing memory){</span>
<span class="cstat-no" title="statement not covered" >        return s_listings[_tokenId] ;</span>
    }
    
&nbsp;
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Jul 31 2023 19:17:00 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
